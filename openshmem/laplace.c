/*
* hw 4 Yuping Lu
* OpenSHMEM: Stencil code with Ghost cell
*/
#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <sys/time.h>


int main (int argc, char *argv[]) {
	int n, i, j, it;
	double diff, convergence;

	/*
	* Configure input matrix a.
	* If a is s*s, set b (s-1)*(s-1) and n = s-1.
	*/
	double a[10][10] = {

		0.81472,0.15761,0.65574,0.70605,0.43874,0.27603,0.75127,0.84072,0.35166,0.075854,
		0.90579,0.97059,0.035712,0.031833,0.38156,0.6797,0.2551,0.25428,0.83083,0.05395,
		0.12699,0.95717,0.84913,0.27692,0.76552,0.6551,0.50596,0.81428,0.58526,0.5308,
		0.91338,0.48538,0.93399,0.046171,0.7952,0.16261,0.69908,0.24352,0.54972,0.77917,
		0.63236,0.80028,0.67874,0.097132,0.18687,0.119,0.8909,0.92926,0.91719,0.93401,
		0.09754,0.14189,0.75774,0.82346,0.48976,0.49836,0.95929,0.34998,0.28584,0.12991,
		0.2785,0.42176,0.74313,0.69483,0.44559,0.95974,0.54722,0.1966,0.7572,0.56882,
		0.54688,0.91574,0.39223,0.3171,0.64631,0.34039,0.13862,0.25108,0.75373,0.46939,
		0.95751,0.79221,0.65548,0.95022,0.70936,0.58527,0.14929,0.61604,0.38045,0.011902,
		0.96489,0.95949,0.17119,0.034446,0.75469,0.22381,0.25751,0.47329,0.56782,0.33712
	};
	
	double b[9][9];
	n = 9;

	it = 0;
	convergence = 1.0;
	while(convergence > 1.0e-2 && it < 100) {
		diff = 0.0;
		for(j=1; j<n; j++)
			for(i=1; i<n; i++) {
				b[i][j] = 0.25*(a[i-1][j] + a[i+1][j] + a[i][j-1] + a[i][j+1]);
				diff += (b[i][j]-a[i][j])*(b[i][j]-a[i][j]);
			}

		for(j=1; j<n; j++)
			for(i=1; i<n; i++)
				a[i][j] = b[i][j];

		convergence = sqrt(diff);
		it++;
	}
	n++;
	printf("iterations: %d \n", it);
	for(i=0; i<n; i++) {
		for(j=0; j<n; j++) {
			printf("%lf ", a[i][j]);
		}
		printf("\n");
	}

	return 0;
}



